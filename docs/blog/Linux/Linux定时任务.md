# 目录

# 1. crontab 命令

`Linux crontab` 是用来定期执行程序的命令。当安装完成操作系统之后，默认会启动此任务调度命令。

`crond` 命令每分钟会定期检查是否有要执行的工作，如果有要执行的工作便会自动执行该工作。

> 新创建的 `cron` 任务，不会马上执行，至少要过 `2` 分钟后才可以，当然你可以重启 `cron` 来马上执行。

而 `linux` 任务调度的工作主要分为以下两类：

1. 系统执行的工作：系统周期性所要执行的工作，如备份系统数据、清理缓存
2. 个人执行的工作：某个用户定期要做的工作，例如每隔 `10` 分钟检查邮件服务器是否有新信，这些工作可由每个用户自行设置

# 2. 使用说明

## 2.1 语法

``` bash
crontab [ -u user ] file
```

或

``` bash
crontab [ -u user ] { -l | -r | -e }
```

## 2.2 参数

`crontab` 是用来让使用者在固定时间或固定间隔执行程序之用，换句话说，也就是类似使用者的时程表。

`-u user` 是设定指定 `user` 的时程表，这个前提是你必须要有其权限(比如说是 `root`)才能够指定他人的时程表。

如果不使用 `-u user` 的话，就是表示设定自己的时程表。


`-e`: 执行文字编辑器来设定时程表，内定的文字编辑器是 VI，如果你想用别的文字编辑器，则请先设定 VISUAL 环境变数来指定使用那个文字编辑器(比如说 setenv VISUAL joe)

`-r`: 删除目前的时程表

`-l`: 列出目前的时程表

## 2.3 格式

> f1 f2 f3 f4 f5 program

其中 `f1` 是表示分钟，`f2` 表示小时，`f3` 表示一个月份中的第几日，`f4` 表示月份，`f5` 表示一个星期中的第几天。`program` 表示要执行的程序。

当 `f1` 为 `*` 时表示每分钟都要执行 `program`，当 `f2` 为 `*` 时表示每小时都要执行程序，其余类推；

当 `f1` 为 `a-b` 时表示从第 `a` 分钟到第 `b` 分钟这段时间内要执行，`f2` 为 `a-b` 时表示从第 `a` 到第 `b` 小时都要执行，其余类推；

当 `f1` 为 `*/n` 时表示每 `n` 分钟个时间间隔执行一次，`f2` 为 `*/n` 表示每 `n` 小时个时间间隔执行一次，其余类推；

当 `f1` 为 `a`, `b`, `c`,... 时表示第 `a`, `b`, `c`,... 分钟要执行，`f2` 为 `a`, `b`, `c`,... 时表示第 `a`, `b`, `c`...个小时要执行，其余类推；

``` text
*    *    *    *    *
-    -    -    -    -
|    |    |    |    |
|    |    |    |    +----- 星期中星期几 (0 - 6) (星期天 为0)
|    |    |    +---------- 月份 (1 - 12) 
|    |    +--------------- 一个月中的第几天 (1 - 31)
|    +-------------------- 小时 (0 - 23)
+------------------------- 分钟 (0 - 59)
```

# 3. 应用示例

> 每一分钟执行一次 `/bin/ls`
``` bash
* * * * * /bin/ls
```

> 在 `12` 月内, 每天的早上 `6` 点到 `12` 点，每隔 `3` 个小时 `0` 分钟执行一次 `/usr/bin/backup`
``` bash
0 6-12/3 * 12 * /usr/bin/backup
```

> 周一到周五，每天下午 `5:00` 执行一次 `/usr/bin/backup`
``` bash
0 17 * * 1-5 /usr/bin/backup
```

> 每月每天的午夜 `0` 点 `20` 分, `2` 点 `20` 分, `4` 点 `20` 分....执行 `echo "haha"`
``` bash
20 0-23/2 * * * echo "haha"
```

* 下面再看看几个具体的例子

> 每两个小时重启一次 `apache`
``` bash
0 */2 * * * /sbin/service httpd restart
```

> 每天`7：50`开启 `ssh` 服务
``` bash
50 7 * * * /sbin/service sshd start
```

> 每月 `1` 号和 `15` 号检查 `/home` 磁盘 
``` bash
0 0 1,15 * * fsck /home
```

> 每小时的第一分执行 /home/bruce/backup
``` bash
1 * * * * /home/bruce/backup  
```

# 4. 特殊应用

`crontab` 执行循环任务时，最小时间单位是分钟，如果想要以秒为单位执行循环任务，可以如下操作

新建脚本文件 `cron-seconds.sh`，每三秒执行一次 `sync`，时间精度不准。

``` bash
#!/bin/bash

for((i=1;i<=20;i++));do
    sync
    sleep 3
done
```

然后写入的 `crontab` 里每分钟执行一次，如下 `crontab -e`

``` bash
* * * * * /bin/bash /home/somedir/cron-seconds.sh
```

参考：<https://blog.csdn.net/weixin_42470145/article/details/116930204>

<https://www.runoob.com/linux/linux-comm-crontab.html>
